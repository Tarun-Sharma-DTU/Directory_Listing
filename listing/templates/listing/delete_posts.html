{% extends "listing/base.html" %}

{% block title %}Deleting Links{% endblock %}

{% block content %}

{% if messages %}
<div class="message-container">
    {% for message in messages %}
    <div class="{{ message.tags }}">
        {{ message }}
    </div>
    {% endfor %}
</div>
{% endif %}

<div class="container mt-5">
    <h2>Upload Excel or Paste Links for Delete</h2>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <!-- File Upload -->
        <div class="mb-3">
            <label for="excelFileUpload" class="form-label">Upload Excel File</label>
            <input class="form-control" type="file" id="excelFileUpload" name="excel_file" accept=".xlsx, .xls">
        </div>

        <!-- Placeholder for Links -->
        <div class="mb-3">
            <label for="linkPasteArea" class="form-label">Or Paste Links Here</label>
            <textarea class="form-control" id="linkPasteArea" name="links" rows="10" placeholder="Paste your links here..."></textarea>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="btn btn-primary">Submit</button>
    </form>
</div>


<div id="taskStatusContainer">
    <h2>Deletion Task Status</h2>
    <table id="taskTable" class="task-table">
        <thead>
            <tr>
                <th>URL</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            <!-- Task statuses will be appended here dynamically -->
        </tbody>
    </table>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
    function updateTaskStatuses() {
        fetch('/check_delete_status/')
            .then(response => response.json())
            .then(data => {
                const taskTableBody = document.getElementById('taskTable').getElementsByTagName('tbody')[0];
                taskTableBody.innerHTML = ''; // Clear current list

                data.tasks.forEach(task => {
                    const row = taskTableBody.insertRow();
                    const cellUrl = row.insertCell(0);
                    const cellStatus = row.insertCell(1);

                    cellUrl.textContent = task.url;
                    cellStatus.textContent = task.status;

                    if (task.status === 'SUCCESS') {
                        row.className = 'success';
                    } else if (task.status === 'FAILED') {
                        row.className = 'failed';
                    }
                });
            })
            .catch(error => console.error('Error fetching task statuses:', error));
    }

    updateTaskStatuses();
    setInterval(updateTaskStatuses, 5000); // Update every 5 seconds
});

</script>



  
  

{% endblock %}